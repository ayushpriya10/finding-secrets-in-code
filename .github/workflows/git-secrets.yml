name: Git-secret Scan

on:
  push:
    branches: [ master ]

jobs:
  scan:
    runs-on: ubuntu-18.04

    steps:
    - uses: actions/checkout@v2

    # Cloning git-secrets and installing it on runner
    - name: Install git-secrets
      run: |
        git clone https://github.com/awslabs/git-secrets.git
        cd git-secrets
        sudo make install
    
    # Using curl to fetch signatures and store them in a file.
    # Configuring provider
    - name: Configuring git-secrets
      run: |
        export URL=https://gist.githubusercontent.com/ayushpriya10/cffb907a9fb0f3546d623c023c2bd4ce/raw/867a98cbf8dd0dfc0bf188d34f7b4613804e10b9/git-secrets-signatures
        curl $URL > signatures
        cat signatures
        git secrets --add-provider -- cat signatures
        
    # Executing Scan
    - name: Executing Scan
      run: git secrets --scan
